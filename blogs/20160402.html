
<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>DevOps Glue AWS - LINUX  - NodeJS - AJAX - MySQL - Web</title>
    <!-- Bootstrap Core CSS -->
    <link href="../css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom CSS -->
    <link href="../css/clean-blog.min.css" rel="stylesheet">

    <!-- Custom Fonts -->
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href='https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>

    <!-- jQuery -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
    <!-- Js Functions -->
    <script src="../js/ajax.js"></script> 
    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

</head>

<body>

    <!-- Navigation -->
    <nav class="navbar navbar-default navbar-custom navbar-fixed-top">
        <div class="container-fluid">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header page-scroll">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="https://au.linkedin.com/in/jamkwok">James Kwok</a>
            </div>

            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="../index.html">Home</a>
                    </li>
                </ul>
            </div>
            <!-- /.navbar-collapse -->
        </div>
        <!-- /.container -->
    </nav>

    <!-- Page Header -->
    <!-- Set your background image for this header on the line below. -->
    <header class="intro-header" style="background-image: url('../img/20160313.jpg')">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                    <div id="blogtitle" class="post-heading">
                    </div>
                </div>
            </div>
        </div>
    </header>

    <script> getBlogTitle("20160402");</script>


    <!-- Post Content -->
    <article>
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
		    <p>NodeJS creates its own webserver instead of using a dedicated webserver like apache for static html files. This tutorial will aim to use nodejs to host static html index file with the words  'hello world'. After a few seconds we aim to replace that same text with dynamic content generated by Node using an ajax call. </p>  	
		   
                    <p> After installing nodejs and express, we set up the node_server.js file. The express framework allows us to easily display static html files in nodejs such as our index.html. Node will render the index.html file when the root domain "yourdomain.com" is typed in the browser, this is shown in the 'services main page' section of the code. The section under this will display our nodejs dynamic content when the url path is http://yourdomain.com/helloworld occurs with the GET method. Instead of rendering a static file, nodeJs will use res.send to send the dynamic content. In practice we can generate dynamic html code in this way with NodeJs logic. Port 80 is chosen to host the webserver and is started using the node command as shown on the last line of node_server.js Express renders the static index.html which is not the same as simply printing out the html code which would only display the raw html. </p>  
 
		    <p>node_servers.js template:</p>
		    <div class="bootstrap-demo">
  			<pre><p>
 #Install Nodejs and express  
 yum -y install nodejs npm
 npm install express

 vi node_server.js
 var express = require("express");
 var app = express();

 /* serves main page */
 app.get("/", function(req, res) {
    res.sendfile('index.html')
 });

  app.get("/helloworld", function(req, res) {
        /* some server side logic */
        res.send(200,"NodeJs is Serving dynamic content");
  });

 /* serves all the static files */
 app.get(/^(.+)$/, function(req, res){
     console.log('static file request : ' + req.params);
     res.sendfile( __dirname + req.params[0]);
 });

 var port = process.env.PORT || 80;
 app.listen(port, function() {
   console.log("Listening on " + port);
 });





 #Start the NodeJS express server
 node node_server.js

			</p></pre>
		    </div>

		    <p>Ajax is a way to dynamically replace content on a html page without reloading a page such as traditional server side code like php. Ajax is invoked by setting up an xmlhttp connection when in our example the hello_world javascript function is called. When this is called by our timeout function which calls the hello_world function after 2 seconds, xmlhttp makes a call to http://yourdomain.com/helloworld nodejs detects the helloworld path as written in our nodejs code and sends the dynamic response. '$('#demo').html(xmlhttp.responseText);' replaces the content in the div tagged as #demo with the dynamic content generated by nodeJS. So why use Ajax, in our example it was just used to replace text a few seconds later without reloading the page. In practice we could load a page, wait for a user to perform an action and use ajax to call nodejs which would return values from a database. This would be better than serverside code which would display a blank page while the database was doing its thing, instead the user would see the html page with a wait spinner and then dynamically replace the div section with database content. </p>

		    <p>Cross domain calls are not allowed in most browsers, for example I setup the static html page in apache under http://yourdomain.com and then try to call nodejs under http://mydomain.com . This is not allowed for the obvious security reasons as if the static html were hacked it could divert sensitive information to an entirely different domain. Ajax will never display a 200 code when a cross domain call is made. </p>

		    <p>Ajax index.html template:</p>
                    <div class="bootstrap-demo">
                        <pre><p>
 &lthtml&gt
 &ltscript&gt
         function hello_world() {
                xmlhttp=new XMLHttpRequest();
                xmlhttp.onreadystatechange=function() {
                        if(xmlhttp.readyState==4 && xmlhttp.status==200) {
                                $('#demo').html(xmlhttp.responseText);
                        }
                }
                xmlhttp.open("GET","http://yourdomain.com/helloworld");
                xmlhttp.send();
         }
         <!-- Call ajax func with 2 sec delay-->
         setTimeout(function(){ hello_world(); }, 2000);
 &lt/script&gt
 &ltbody&gt
 &ltdiv id="demo"&gt hello world &lt/div&gt
 &lt/body&gt
 &ltscript&gt src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js" &lt/script&gt
 &lt/html&gt

                        </p></pre>

                </div>
		<p> Note that index.html and node_server.js should be placed in the same directory for node_server.js to reference index.html. Since node functions as a webserver it is not necessary to install a dedicated webserver such as apache. </p>

		<div class="jumbotron">
                <p>You should see the transition 2 seconds later as shown in the picture below: </p>
                    <a href="../img/20160402_artifact.jpg">
                        <img class="img-responsive img-rounded" src="../img/20160402_artifact.jpg" alt="">
                    </a>
                </div>
		
		
		<h2 class="section-heading">Ajax Post with NodeJS</h2>	
		<p> The below uses express to route Post data on port 8000 and localhost 127.0.0.1 (these can be changed to your domain), the timer first calls a GET request after 1 second and then sends the value 'AMAZING' as a post after 2 seconds. Additionally in express 4.0, you will need to install separate midleware like body parser. </p>

		<p>Ajax POST node_server.js template:</p>
                   <div class="bootstrap-demo">
                        <pre><p>
 var express = require("express");
 var app = express();
 
 //For express 4.0 npm install --save body-parser 
 var bodyParser = require('body-parser');

 app.use(bodyParser.urlencoded({ extended: false }));
 app.use(bodyParser.json());

 /* serves main page */
 app.get("/", function(req, res) {
    res.sendfile('index.html')
 });
 
 app.get("/underworld", function(req, res) {
        res.send(200,"Yo!");
 });
 
 app.post("/helloworld", function(req, res) {
       /* some server side logic */
      	var value=req.body.value; 
	console.log(value);	
	res.send(200,value);
 });

 var port = process.env.PORT || 8000;
 app.listen(port, function() {
   console.log("Listening on " + port);
 });

			</p></pre>
                </div>

		<p>Ajax POST index.html template:</p>
                <div class="bootstrap-demo">
                        <pre><p>
&lthtml&gt
&ltbody&gt
&ltdiv id="demo"&gt hello world &lt/div&gt
&lt/body&gt

&ltscript&gt
         function hello_world() {
                xmlhttp=new XMLHttpRequest();
	 	xmlhttp.onreadystatechange=function() {
                        if(xmlhttp.readyState==4 && xmlhttp.status==200 ) {
                                $('#demo').html(xmlhttp.responseText);
			}
                }
                xmlhttp.open("POST","http://127.0.0.1:8000/helloworld");
                xmlhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded"); 
		xmlhttp.send("value=AMAZING");
	}

	function under_world() {
                xmlhttp=new XMLHttpRequest();
                xmlhttp.onreadystatechange=function() {
                        if(xmlhttp.readyState==4 && xmlhttp.status==200) {
                                $('#demo').html(xmlhttp.responseText);
                        }
                }
                xmlhttp.open("GET","http://127.0.0.1:8000/underworld");
                xmlhttp.send();
         }
         
	 setTimeout(function(){ under_world(); }, 1000); 
         setTimeout(function(){ hello_world(); }, 2000);
&lt/script&gt
&ltscript&gt src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js" &lt/script&gt
&lt/html&gt
			</p></pre>
                </div>
	
	        <hr>
	        <div id="disqus_thread"></div>
<script>
/**
* RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
* LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
*/
/*
var disqus_config = function () {
this.page.url = PAGE_URL; // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};
*/
(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');

s.src = '//nodejsdevopsgluecom.disqus.com/embed.js';

s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
		</div>
            </div>
        </div>
    </article>
    <hr>

    <!-- Footer -->
     <footer>
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                    <ul class="list-inline text-center">
                        <li>
                            <a href="https://twitter.com/jameszkwok">
                                <span class="fa-stack fa-lg">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                                </span>
                            </a>
                        </li>
                        <li>
                            <a href="https://www.facebook.com/james.kwok.334">
                                <span class="fa-stack fa-lg">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fa fa-facebook fa-stack-1x fa-inverse"></i>
                                </span>
                            </a>
                        </li>
                        <li>
                            <a href="https://au.linkedin.com/in/jamkwok">
                                <span class="fa-stack fa-lg">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i>
                                </span>
                            </a>
                        </li>
                    </ul>
                     <p class="copyright text-muted">Copyright &copy; DevOpsGlue.com 2016</p>
                </div>
            </div>
        </div>
    </footer>
	
    <!-- jQuery -->
    <script src="../js/jquery.js"></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="../js/bootstrap.min.js"></script>

    <!-- Custom Theme JavaScript -->
    <script src="../js/clean-blog.min.js"></script>

</body>

</html>

